---
title: "Data prep"
author: "BVD"
date: "6/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load data
```{r message=FALSE}
load("~/DFW7_1_19.RData")
DFW<-DFW7_1_19

library("hglm")
```

ID LA courses
```{r}
DFW$LA<-0
DFW$LA[
  DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202A" & DFW$TERM=="2172" | 
         DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202A" & DFW$TERM=="2178" | 
         DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202A" & DFW$TERM=="2182" | 
         DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202A" & DFW$TERM=="2188" | 
         DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202A" & DFW$TERM=="2192" | 
         DFW$INSTRUCTOR1_NAME=="Brookes,David T" & DFW$Number=="202B" & DFW$TERM=="2168" |
         DFW$INSTRUCTOR1_NAME=="Arpin,Paul C" & DFW$Number=="204B" & DFW$TERM=="2172" | 
         DFW$INSTRUCTOR1_NAME=="Arpin,Paul C" & DFW$Number=="204B" & DFW$TERM=="2178" | 
         DFW$INSTRUCTOR1_NAME=="Arpin,Paul C" & DFW$Number=="204B" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Arpin,Paul C" & DFW$Number=="204A" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Arpin,Paul C" & DFW$Number=="202B" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Ayars,Eric J" & DFW$Number=="204A" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Ayars,Eric J" & DFW$Number=="204A" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Ayars,Eric J" & DFW$Number=="204A" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="118" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="118" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="119" & DFW$TERM=="2168" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="119" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="119" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="119" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="119" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Bailey,Paul L" & DFW$Number=="120" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Danner,Richard S" & DFW$Number=="118" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Danner,Richard S" & DFW$Number=="120" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Danner,Richard S" & DFW$Number=="118" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Herrera,Christine A" & DFW$Number=="120" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Herrera,Christine A" & DFW$Number=="120" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Herrera,Christine A" & DFW$Number=="120" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Herrera,Christine A" & DFW$Number=="120" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202A" & DFW$TERM=="2168" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202A" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202A" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202B" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202B" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="202B" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Lin,Yuhfen" & DFW$Number=="204B" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Newton,Mark H" & DFW$Number=="343" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Newton,Mark H" & DFW$Number=="343" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Pechkis,Hyewon K" & DFW$Number=="204B" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Pechkis,Hyewon K" & DFW$Number=="204B" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Pechkis,Hyewon K" & DFW$Number=="204B" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Petrova-Mayor,Anna I" & DFW$Number=="204A" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Petrova-Mayor,Anna I" & DFW$Number=="204C" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Petrova-Mayor,Anna I" & DFW$Number=="204C" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Petrova-Mayor,Anna I" & DFW$Number=="204C" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Strand,Krista L" & DFW$Number=="110" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Strand,Krista L" & DFW$Number=="110" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Tran,Cawa" & DFW$Number=="153" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Tran,Cawa" & DFW$Number=="153" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2168" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2172" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="141" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="321" & DFW$TERM=="2178" |
    DFW$INSTRUCTOR1_NAME=="Van Dusen,Benjamin C" & DFW$Number=="350" & DFW$TERM=="2182" |
    DFW$INSTRUCTOR1_NAME=="Zou,Xueli" & DFW$Number=="204A" & DFW$TERM=="2188" |
    DFW$INSTRUCTOR1_NAME=="Zou,Xueli" & DFW$Number=="204A" & DFW$TERM=="2192" |
    DFW$INSTRUCTOR1_NAME=="Pechkis,Joseph A" & DFW$Number=="202B" & DFW$TERM=="2192"
         ] <- 1

```

variables I care about
```{r}
DFW <- DFW[!is.na(DFW$Grade_Group),]
DFW$DFW<-ifelse(DFW$Grade_Group=="A",0,ifelse(DFW$Grade_Group=="B",0,ifelse(DFW$Grade_Group=="C",0,ifelse(DFW$Grade_Group=="D",0,1))))
DFW$DDFW<-ifelse(DFW$Grade_Group=="A",0,ifelse(DFW$Grade_Group=="B",0,ifelse(DFW$Grade_Group=="C",0,1)))
names(DFW)[names(DFW)=="INSTRUCTOR1_NAME"] <- "instructor"
names(DFW)[names(DFW)=="FirstGeneration"] <- "firstgen"
names(DFW)[names(DFW)=="COURSE_ID"] <- "course"
```

creating dummy variables
```{r}

DFW$firstgend <- ifelse(DFW$firstgen=="First Generation Student",1,0)

DFW$white <- ifelse(DFW$Ethnicity=="White",1,0)
DFW$black <- ifelse(DFW$Ethnicity=="Black/African American",1,0)
DFW$unknown <- ifelse(DFW$Ethnicity=="Unknown",1,ifelse(DFW$Ethnicity=="NULL",1,0))
DFW$asian <- ifelse(DFW$Ethnicity=="Asian",1,0)
DFW$mult_race <- ifelse(DFW$Ethnicity=="Two or More Races",1,0)
DFW$nonres <- ifelse(DFW$Ethnicity=="Non-Resident Alien",1,0)
DFW$pac_isl <- ifelse(DFW$Ethnicity=="Pacific Islander",1,0)
DFW$indian <- ifelse(DFW$Ethnicity=="American Indian/Alaskan Native",1,0)

DFW$Female <- ifelse(DFW$GenderLabel=="Male",0,1)

```

subset data
```{r}
DFW_phys <- DFW[DFW$Subject=="PHYS",]
DFW_math <- DFW[DFW$Subject=="MATH",]
DFW_math_phys <- DFW[DFW$Subject=="PHYS" | DFW$Subject=="MATH",]
```

Models
```{r}
m1 <- (DFW ~ 1)
m2 <- (DFW ~ white)
m3 <- (DFW ~ white + firstgend)
m4 <- (DFW ~ white + firstgend + Female)
m5 <- (DFW ~ white + firstgend + Female + LA)
m6 <- (DFW ~ white*LA + firstgend*LA +Female*LA)
```

running models - physics
```{r}
p1 <- hglm(fixed = m1, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
p2 <- hglm(fixed = m2, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
p3 <- hglm(fixed = m3, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
p4 <- hglm(fixed = m4, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
p5 <- hglm(fixed = m5, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
p6 <- hglm(fixed = m6, random = ~ 1|course, data=DFW_phys, family = binomial(link = logit))
```

Model outputs - physics
```{r}
summary(p1)
summary(p2)
summary(p3)
summary(p4)
summary(p5)
summary(p6)
```

running models - math & physics
```{r}
mp1 <- hglm(fixed = m1, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
mp2 <- hglm(fixed = m2, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
mp3 <- hglm(fixed = m3, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
mp4 <- hglm(fixed = m4, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
mp5 <- hglm(fixed = m5, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
mp6 <- hglm(fixed = m6, random = ~ 1|course, data=DFW_math_phys, family = binomial(link = logit))
```

Model outputs - physics
```{r}
summary(mp1)
summary(mp2)
summary(mp3)
summary(mp4)
summary(mp5)
summary(mp6)
```
